<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LTX-2 Full Suite</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh; padding: 15px; color: #e0e0e0;
        }
        .container { max-width: 1000px; margin: 0 auto; background: rgba(255,255,255,0.05); backdrop-filter: blur(10px); border-radius: 16px; padding: 20px; border: 1px solid rgba(255,255,255,0.1); }
        h1 { background: linear-gradient(135deg, #667eea, #764ba2, #f093fb); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-size: 28px; margin-bottom: 4px; }
        .subtitle { color: #888; margin-bottom: 20px; font-size: 13px; }
        .tabs { display: flex; gap: 4px; margin-bottom: 20px; flex-wrap: wrap; }
        .tab { padding: 8px 14px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; cursor: pointer; transition: all 0.3s; font-size: 11px; color: #aaa; }
        .tab:hover { background: rgba(255,255,255,0.1); color: #fff; }
        .tab.active { background: linear-gradient(135deg, #667eea, #764ba2); color: white; border-color: transparent; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: 500; color: #ccc; font-size: 12px; }
        input, textarea, select { width: 100%; padding: 10px; background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.1); border-radius: 6px; font-size: 13px; color: #fff; transition: border-color 0.3s; }
        input:focus, textarea:focus, select:focus { outline: none; border-color: #667eea; }
        textarea { resize: vertical; min-height: 60px; font-family: inherit; }
        select option { background: #1a1a2e; }
        .row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .row-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; }
        .row-4 { display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 12px; }
        .row-5 { display: grid; grid-template-columns: 1fr 1fr 1fr 1fr 1fr; gap: 12px; }
        .upload-area { border: 2px dashed rgba(255,255,255,0.2); border-radius: 8px; padding: 20px; text-align: center; cursor: pointer; transition: all 0.3s; background: rgba(0,0,0,0.2); }
        .upload-area:hover { border-color: #667eea; background: rgba(102,126,234,0.1); }
        .upload-area.has-file { border-color: #667eea; border-style: solid; }
        .upload-icon { font-size: 28px; margin-bottom: 6px; }
        .preview { max-width: 100%; max-height: 150px; border-radius: 6px; margin-top: 8px; display: none; }
        .preview.show { display: block; }
        .info-box { background: rgba(102,126,234,0.1); border: 1px solid rgba(102,126,234,0.3); border-radius: 6px; padding: 10px; font-size: 11px; color: #a0b0ff; margin-bottom: 12px; }
        .warning-box { background: rgba(255,152,0,0.1); border-color: rgba(255,152,0,0.3); color: #ffb74d; }
        .success-box { background: rgba(76,175,80,0.1); border-color: rgba(76,175,80,0.3); color: #81c784; }
        button { padding: 12px 24px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.3s; width: 100%; }
        button:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(102,126,234,0.4); }
        button:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
        .btn-secondary { background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); }
        .btn-stop { background: linear-gradient(135deg, #e53935 0%, #c62828 100%); display: none; }
        .btn-stop.active { display: block; }
        .gen-buttons { display: grid; grid-template-columns: 1fr; gap: 10px; }
        .gen-buttons.running { grid-template-columns: 1fr 1fr; }
        .loading { display: none; text-align: center; margin: 15px 0; }
        .loading.active { display: block; }
        .spinner { border: 3px solid rgba(255,255,255,0.1); border-top: 3px solid #667eea; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 0 auto 10px; }
        @keyframes spin { 100% { transform: rotate(360deg); } }
        .status { margin-top: 12px; padding: 10px; border-radius: 6px; font-size: 12px; display: none; }
        .status.active { display: block; }
        .status.info { background: rgba(33,150,243,0.15); border: 1px solid rgba(33,150,243,0.4); color: #64b5f6; }
        .status.success { background: rgba(76,175,80,0.15); border: 1px solid rgba(76,175,80,0.4); color: #81c784; }
        .status.error { background: rgba(244,67,54,0.15); border: 1px solid rgba(244,67,54,0.4); color: #e57373; }
        .status.warning { background: rgba(255,152,0,0.15); border: 1px solid rgba(255,152,0,0.4); color: #ffb74d; }
        .video-container { margin-top: 15px; text-align: center; display: none; }
        video { max-width: 100%; border-radius: 10px; box-shadow: 0 6px 24px rgba(0,0,0,0.3); }
        .section-header { display: flex; justify-content: space-between; align-items: center; padding: 10px 12px; background: rgba(255,255,255,0.03); border-radius: 6px; cursor: pointer; margin-bottom: 12px; user-select: none; font-size: 12px; }
        .section-header:hover { background: rgba(255,255,255,0.06); }
        .section-content { margin-bottom: 15px; }
        .section-content.collapsed { display: none; }
        .hint { font-size: 10px; color: #888; margin-top: 3px; }
        .checkbox-label { display: flex; align-items: center; gap: 6px; cursor: pointer; font-size: 12px; }
        .checkbox-label input { width: auto; }
        .slider-container { display: flex; align-items: center; gap: 8px; }
        .slider-container input[type="range"] { flex: 1; }
        .slider-value { min-width: 40px; text-align: center; background: rgba(0,0,0,0.3); padding: 3px 6px; border-radius: 4px; font-size: 11px; }
        .preset-btn { padding: 5px 10px; background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.15); border-radius: 5px; cursor: pointer; font-size: 10px; color: #aaa; transition: all 0.2s; }
        .preset-btn:hover { background: rgba(102,126,234,0.2); border-color: #667eea; color: #fff; }
        .preset-btn.active { background: rgba(102,126,234,0.3); border-color: #667eea; color: #fff; }
        .presets { display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 12px; }
        .advanced-section { background: rgba(0,0,0,0.15); border-radius: 8px; padding: 12px; margin-top: 10px; }
        .param-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 10px; }
        .mini-label { font-size: 10px; color: #999; margin-bottom: 3px; }
        .mini-input { padding: 6px 8px; font-size: 11px; }
        .divider { height: 1px; background: rgba(255,255,255,0.1); margin: 15px 0; }
        .multi-control-box { background: rgba(102,126,234,0.08); border: 1px solid rgba(102,126,234,0.2); border-radius: 8px; padding: 12px; margin-top: 10px; }
        .control-toggle { display: flex; align-items: center; justify-content: space-between; padding: 8px 10px; background: rgba(0,0,0,0.2); border-radius: 6px; margin-bottom: 8px; }
        .control-toggle:last-child { margin-bottom: 0; }
        .control-toggle-left { display: flex; align-items: center; gap: 8px; }
        .control-toggle-right { display: flex; align-items: center; gap: 6px; }
        .control-icon { font-size: 16px; }
        .strength-mini { width: 60px !important; padding: 4px 6px; font-size: 11px; text-align: center; }
    </style>
</head>
<body>
<div class="container">
    <h1>üé¨ LTX-2 Full Suite</h1>
    <p class="subtitle">T2V ‚Ä¢ I2V ‚Ä¢ V2V ‚Ä¢ V2V Multi ‚Ä¢ Keyframe ‚Ä¢ Detailer ‚Ä¢ Extend ‚Ä¢ Upscale ‚Ä¢ Temporal ‚Äî All Parameters Exposed</p>
    
    <div class="tabs">
        <div class="tab active" data-mode="t2v">‚úèÔ∏è T2V</div>
        <div class="tab" data-mode="i2v">üì∑ I2V</div>
        <div class="tab" data-mode="v2v">üé• V2V</div>
        <div class="tab" data-mode="v2v_multi">üéõÔ∏è V2V Multi</div>
        <div class="tab" data-mode="keyframe">üîó Keyframe</div>
        <div class="tab" data-mode="detailer">‚ú® Detailer</div>
        <div class="tab" data-mode="extend">‚è© Extend</div>
        <div class="tab" data-mode="upscale">‚¨ÜÔ∏è Upscale</div>
        <div class="tab" data-mode="upscale_temporal">üéûÔ∏è Temporal</div>
    </div>
    
    <div class="row" style="margin-bottom:15px;">
        <div class="form-group">
            <label>RunPod API Key</label>
            <input type="password" id="apiKey" placeholder="Your RunPod API key">
        </div>
        <div class="form-group">
            <label>Endpoint ID</label>
            <input type="text" id="endpointId" placeholder="abc123xyz">
        </div>
    </div>
    
    <!-- T2V Tab -->
    <div id="t2v-content" class="tab-content active">
        <div class="info-box success-box">üí° <strong>Text-to-Video:</strong> Generate video from text with 2-stage upscaling pipeline.</div>
    </div>
    
    <!-- I2V Tab -->
    <div id="i2v-content" class="tab-content">
        <div class="info-box">üì∑ <strong>Image-to-Video:</strong> Animate a static image as the first frame.</div>
        <div class="row">
            <div class="form-group">
                <label>Upload Image</label>
                <div class="upload-area" id="i2vUpload" onclick="document.getElementById('i2vInput').click()">
                    <input type="file" id="i2vInput" accept="image/*" style="display:none" onchange="handleFile(event,'i2v')">
                    <div class="upload-icon">üì∑</div>
                    <div id="i2vText">Click to upload</div>
                    <img id="i2vPreview" class="preview">
                </div>
            </div>
            <div class="form-group">
                <label>I2V Strength</label>
                <div class="slider-container">
                    <input type="range" id="i2vStrength" min="0.5" max="1.5" step="0.1" value="1.0" oninput="updateSlider('i2vStrength')">
                    <span class="slider-value" id="i2vStrengthVal">1.0</span>
                </div>
                <div class="hint">Image conditioning strength</div>
            </div>
        </div>
    </div>
    
    <!-- V2V Tab (Single Control) -->
    <div id="v2v-content" class="tab-content">
        <div class="info-box">üé• <strong>Video-to-Video:</strong> Transform with single structural control (Canny/Depth/Pose).</div>
        <div class="form-group">
            <label>Upload Reference Video</label>
            <div class="upload-area" id="v2vUpload" onclick="document.getElementById('v2vInput').click()">
                <input type="file" id="v2vInput" accept="video/*" style="display:none" onchange="handleFile(event,'v2v')">
                <div class="upload-icon">üé•</div>
                <div id="v2vText">Click to upload video</div>
            </div>
        </div>
        <div class="row-3">
            <div class="form-group">
                <label>Control Type</label>
                <select id="controlType" onchange="updateControlInfo()">
                    <option value="canny">üì≤ Canny</option>
                    <option value="depth">üåä Depth</option>
                    <option value="pose">üï∫ Pose</option>
                </select>
            </div>
            <div class="form-group">
                <label>Control LoRA Strength</label>
                <div class="slider-container">
                    <input type="range" id="controlStrength" min="0.5" max="1.5" step="0.1" value="1.0" oninput="updateSlider('controlStrength')">
                    <span class="slider-value" id="controlStrengthVal">1.0</span>
                </div>
            </div>
            <div class="form-group">
                <label>Guiding Strength</label>
                <div class="slider-container">
                    <input type="range" id="v2vGuidingStrength" min="0.3" max="1.5" step="0.1" value="1.0" oninput="updateSlider('v2vGuidingStrength')">
                    <span class="slider-value" id="v2vGuidingStrengthVal">1.0</span>
                </div>
            </div>
        </div>
        <div class="row" id="cannyParams">
            <div class="form-group">
                <label>Canny Low</label>
                <div class="slider-container">
                    <input type="range" id="cannyLow" min="0.1" max="0.5" step="0.05" value="0.4" oninput="updateSlider('cannyLow')">
                    <span class="slider-value" id="cannyLowVal">0.4</span>
                </div>
            </div>
            <div class="form-group">
                <label>Canny High</label>
                <div class="slider-container">
                    <input type="range" id="cannyHigh" min="0.5" max="1.0" step="0.05" value="0.8" oninput="updateSlider('cannyHigh')">
                    <span class="slider-value" id="cannyHighVal">0.8</span>
                </div>
            </div>
        </div>
        <div class="row-3" id="v2vAdvancedRow">
            <div class="form-group">
                <label class="checkbox-label"><input type="checkbox" id="v2vSkipUpscale"> Skip Upscale</label>
            </div>
            <div class="form-group">
                <label class="checkbox-label"><input type="checkbox" id="v2vEnableFirstFrame"> Custom 1st Frame</label>
            </div>
            <div class="form-group" id="v2vFFStrengthGroup" style="display:none;">
                <label>1st Frame Strength</label>
                <input type="number" id="firstFrameStrength" class="mini-input" value="1.0" step="0.1" min="0.1" max="2.0">
            </div>
        </div>
        <div class="form-group" id="v2vFirstFrameGroup" style="display:none;">
            <div class="upload-area" id="ffUpload" onclick="document.getElementById('ffInput').click()">
                <input type="file" id="ffInput" accept="image/*" style="display:none" onchange="handleFile(event,'ff')">
                <div id="ffText">Upload first frame image</div>
                <img id="ffPreview" class="preview">
            </div>
        </div>
        
        <div class="section-header" onclick="toggleSection('v2vAdvanced')">
            <span>‚öôÔ∏è V2V Advanced</span><span id="v2vAdvancedToggle">‚ñ∂</span>
        </div>
        <div id="v2vAdvanced" class="section-content collapsed advanced-section">
            <div class="row-3">
                <div class="form-group">
                    <label class="mini-label">Guiding Start Step</label>
                    <input type="number" id="v2vGuidingStart" class="mini-input" value="0" min="0" max="20">
                </div>
                <div class="form-group">
                    <label class="mini-label">Guiding End Step</label>
                    <input type="number" id="v2vGuidingEnd" class="mini-input" value="1000" min="10" max="1000">
                </div>
                <div class="form-group">
                    <label class="mini-label">Depth/Pose Resolution</label>
                    <input type="number" id="depthResolution" class="mini-input" value="512" step="64" min="256" max="1024">
                </div>
            </div>
            <div class="row-3">
                <div class="form-group">
                    <label class="checkbox-label"><input type="checkbox" id="poseHand" checked> Detect Hands</label>
                </div>
                <div class="form-group">
                    <label class="checkbox-label"><input type="checkbox" id="poseBody" checked> Detect Body</label>
                </div>
                <div class="form-group">
                    <label class="checkbox-label"><input type="checkbox" id="poseFace" checked> Detect Face</label>
                </div>
            </div>
        </div>
    </div>
    
    <!-- V2V Multi-Control Tab -->
    <div id="v2v_multi-content" class="tab-content">
        <div class="info-box success-box">üéõÔ∏è <strong>V2V Multi-Control:</strong> Combine Canny + Depth + Pose for maximum structural guidance!</div>
        <div class="form-group">
            <label>Upload Reference Video</label>
            <div class="upload-area" id="v2vMultiUpload" onclick="document.getElementById('v2vMultiInput').click()">
                <input type="file" id="v2vMultiInput" accept="video/*" style="display:none" onchange="handleFile(event,'v2vMulti')">
                <div class="upload-icon">üéõÔ∏è</div>
                <div id="v2vMultiText">Click to upload video</div>
            </div>
        </div>
        
        <div class="multi-control-box">
            <label style="margin-bottom:10px;display:block;">Control Signals (enable/disable & set strengths)</label>
            
            <div class="control-toggle">
                <div class="control-toggle-left">
                    <input type="checkbox" id="multiEnableCanny" checked>
                    <span class="control-icon">üì≤</span>
                    <span>Canny (Edges)</span>
                </div>
                <div class="control-toggle-right">
                    <span class="mini-label">Strength:</span>
                    <input type="number" id="multiCannyStrength" class="strength-mini" value="1.0" step="0.1" min="0.1" max="2.0">
                </div>
            </div>
            
            <div class="control-toggle">
                <div class="control-toggle-left">
                    <input type="checkbox" id="multiEnableDepth" checked>
                    <span class="control-icon">üåä</span>
                    <span>Depth (3D Structure)</span>
                </div>
                <div class="control-toggle-right">
                    <span class="mini-label">Strength:</span>
                    <input type="number" id="multiDepthStrength" class="strength-mini" value="1.0" step="0.1" min="0.1" max="2.0">
                </div>
            </div>
            
            <div class="control-toggle">
                <div class="control-toggle-left">
                    <input type="checkbox" id="multiEnablePose" checked>
                    <span class="control-icon">üï∫</span>
                    <span>Pose (Body/Hands/Face)</span>
                </div>
                <div class="control-toggle-right">
                    <span class="mini-label">Strength:</span>
                    <input type="number" id="multiPoseStrength" class="strength-mini" value="1.0" step="0.1" min="0.1" max="2.0">
                </div>
            </div>
        </div>
        
        <div class="row" style="margin-top:12px;">
            <div class="form-group">
                <label>Guiding Strength</label>
                <div class="slider-container">
                    <input type="range" id="multiGuidingStrength" min="0.3" max="1.5" step="0.1" value="1.0" oninput="updateSlider('multiGuidingStrength')">
                    <span class="slider-value" id="multiGuidingStrengthVal">1.0</span>
                </div>
            </div>
            <div class="form-group">
                <label class="checkbox-label" style="margin-top:20px;"><input type="checkbox" id="multiSkipUpscale"> Skip Upscale (faster)</label>
            </div>
        </div>
        
        <div class="row" id="multiCannyParams">
            <div class="form-group">
                <label>Canny Low Threshold</label>
                <div class="slider-container">
                    <input type="range" id="multiCannyLow" min="0.1" max="0.5" step="0.05" value="0.4" oninput="updateSlider('multiCannyLow')">
                    <span class="slider-value" id="multiCannyLowVal">0.4</span>
                </div>
            </div>
            <div class="form-group">
                <label>Canny High Threshold</label>
                <div class="slider-container">
                    <input type="range" id="multiCannyHigh" min="0.5" max="1.0" step="0.05" value="0.8" oninput="updateSlider('multiCannyHigh')">
                    <span class="slider-value" id="multiCannyHighVal">0.8</span>
                </div>
            </div>
        </div>
        
        <div class="section-header" onclick="toggleSection('multiAdvanced')">
            <span>‚öôÔ∏è Multi-Control Advanced</span><span id="multiAdvancedToggle">‚ñ∂</span>
        </div>
        <div id="multiAdvanced" class="section-content collapsed advanced-section">
            <div class="row-3">
                <div class="form-group">
                    <label class="mini-label">Guiding Start Step</label>
                    <input type="number" id="multiGuidingStart" class="mini-input" value="0" min="0" max="20">
                </div>
                <div class="form-group">
                    <label class="mini-label">Guiding End Step</label>
                    <input type="number" id="multiGuidingEnd" class="mini-input" value="1000" min="10" max="1000">
                </div>
                <div class="form-group">
                    <label class="mini-label">Depth/Pose Resolution</label>
                    <input type="number" id="multiDepthResolution" class="mini-input" value="512" step="64" min="256" max="1024">
                </div>
            </div>
            <div class="row-3">
                <div class="form-group">
                    <label class="checkbox-label"><input type="checkbox" id="multiPoseHand" checked> Detect Hands</label>
                </div>
                <div class="form-group">
                    <label class="checkbox-label"><input type="checkbox" id="multiPoseBody" checked> Detect Body</label>
                </div>
                <div class="form-group">
                    <label class="checkbox-label"><input type="checkbox" id="multiPoseFace" checked> Detect Face</label>
                </div>
            </div>
            <div class="row-3">
                <div class="form-group">
                    <label class="checkbox-label"><input type="checkbox" id="multiEnableFirstFrame"> Custom 1st Frame</label>
                </div>
                <div class="form-group" id="multiFFStrengthGroup" style="display:none;">
                    <label class="mini-label">1st Frame Strength</label>
                    <input type="number" id="multiFirstFrameStrength" class="mini-input" value="1.0" step="0.1" min="0.1" max="2.0">
                </div>
            </div>
            <div class="form-group" id="multiFirstFrameGroup" style="display:none;">
                <div class="upload-area" id="multiFFUpload" onclick="document.getElementById('multiFFInput').click()">
                    <input type="file" id="multiFFInput" accept="image/*" style="display:none" onchange="handleFile(event,'multiFF')">
                    <div id="multiFFText">Upload first frame image</div>
                    <img id="multiFFPreview" class="preview">
                </div>
            </div>
        </div>
    </div>
    
    <!-- Keyframe Tab -->
    <div id="keyframe-content" class="tab-content">
        <div class="info-box">üîó <strong>Keyframe:</strong> Interpolate between start and end images.</div>
        <div class="row">
            <div class="form-group">
                <label>Start Frame</label>
                <div class="upload-area" id="kfStartUpload" onclick="document.getElementById('kfStartInput').click()">
                    <input type="file" id="kfStartInput" accept="image/*" style="display:none" onchange="handleFile(event,'kfStart')">
                    <div class="upload-icon">1Ô∏è‚É£</div>
                    <div id="kfStartText">Start image</div>
                    <img id="kfStartPreview" class="preview">
                </div>
            </div>
            <div class="form-group">
                <label>End Frame</label>
                <div class="upload-area" id="kfEndUpload" onclick="document.getElementById('kfEndInput').click()">
                    <input type="file" id="kfEndInput" accept="image/*" style="display:none" onchange="handleFile(event,'kfEnd')">
                    <div class="upload-icon">2Ô∏è‚É£</div>
                    <div id="kfEndText">End image</div>
                    <img id="kfEndPreview" class="preview">
                </div>
            </div>
        </div>
        <div class="row">
            <div class="form-group">
                <label>Start Strength</label>
                <div class="slider-container">
                    <input type="range" id="startStrength" min="0.5" max="1.5" step="0.1" value="1.0" oninput="updateSlider('startStrength')">
                    <span class="slider-value" id="startStrengthVal">1.0</span>
                </div>
            </div>
            <div class="form-group">
                <label>End Strength</label>
                <div class="slider-container">
                    <input type="range" id="endStrength" min="0.5" max="1.5" step="0.1" value="1.0" oninput="updateSlider('endStrength')">
                    <span class="slider-value" id="endStrengthVal">1.0</span>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Detailer Tab -->
    <div id="detailer-content" class="tab-content">
        <div class="info-box success-box">‚ú® <strong>Detailer:</strong> Enhance video quality while preserving structure.</div>
        <div class="form-group">
            <label>Upload Video to Enhance</label>
            <div class="upload-area" id="detailerUpload" onclick="document.getElementById('detailerInput').click()">
                <input type="file" id="detailerInput" accept="video/*" style="display:none" onchange="handleFile(event,'detailer')">
                <div class="upload-icon">‚ú®</div>
                <div id="detailerText">Click to upload video</div>
            </div>
        </div>
        <div class="row-3">
            <div class="form-group">
                <label>Detailer Strength</label>
                <div class="slider-container">
                    <input type="range" id="detailerStrength" min="0.5" max="1.5" step="0.1" value="1.0" oninput="updateSlider('detailerStrength')">
                    <span class="slider-value" id="detailerStrengthVal">1.0</span>
                </div>
            </div>
            <div class="form-group">
                <label>Guiding Strength</label>
                <div class="slider-container">
                    <input type="range" id="detailerGuidingStrength" min="0.3" max="1.5" step="0.1" value="0.8" oninput="updateSlider('detailerGuidingStrength')">
                    <span class="slider-value" id="detailerGuidingStrengthVal">0.8</span>
                </div>
            </div>
            <div class="form-group">
                <label class="checkbox-label"><input type="checkbox" id="detailerSkipUpscale"> Skip Upscale</label>
            </div>
        </div>
        <div class="section-header" onclick="toggleSection('detailerAdvanced')">
            <span>‚öôÔ∏è Detailer Advanced</span><span id="detailerAdvancedToggle">‚ñ∂</span>
        </div>
        <div id="detailerAdvanced" class="section-content collapsed advanced-section">
            <div class="row">
                <div class="form-group">
                    <label class="mini-label">Guiding Start Step</label>
                    <input type="number" id="detailerStartStep" class="mini-input" value="0" min="0" max="20">
                </div>
                <div class="form-group">
                    <label class="mini-label">Guiding End Step</label>
                    <input type="number" id="detailerEndStep" class="mini-input" value="1000" min="10" max="1000">
                </div>
            </div>
        </div>
    </div>
    
    <!-- Extend Tab -->
    <div id="extend-content" class="tab-content">
        <div class="info-box success-box">‚è© <strong>Extend:</strong> Continue video forward or backward.</div>
        <div class="form-group">
            <label>Upload Video to Extend</label>
            <div class="upload-area" id="extendUpload" onclick="document.getElementById('extendInput').click()">
                <input type="file" id="extendInput" accept="video/*" style="display:none" onchange="handleFile(event,'extend')">
                <div class="upload-icon">‚è©</div>
                <div id="extendText">Click to upload video</div>
            </div>
        </div>
        <div class="row-4">
            <div class="form-group">
                <label>Direction</label>
                <select id="extendDirection">
                    <option value="forward">‚è© Forward</option>
                    <option value="backward">‚è™ Backward</option>
                </select>
            </div>
            <div class="form-group">
                <label>New Frames</label>
                <select id="extendFrames">
                    <option value="25">25 (~1s)</option>
                    <option value="49" selected>49 (~2s)</option>
                    <option value="73">73 (~3s)</option>
                    <option value="97">97 (~4s)</option>
                </select>
            </div>
            <div class="form-group">
                <label>Overlap</label>
                <input type="number" id="overlapFrames" class="mini-input" value="8" min="4" max="24" step="4">
            </div>
            <div class="form-group">
                <label>Cond. Strength</label>
                <div class="slider-container">
                    <input type="range" id="extendCondStrength" min="0.5" max="1.5" step="0.1" value="1.0" oninput="updateSlider('extendCondStrength')">
                    <span class="slider-value" id="extendCondStrengthVal">1.0</span>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Upscale Tab -->
    <div id="upscale-content" class="tab-content">
        <div class="info-box success-box">‚¨ÜÔ∏è <strong>Spatial Upscale:</strong> 2x resolution upscale with optional AI refinement for enhanced detail.</div>
        <div class="form-group">
            <label>Upload Video to Upscale</label>
            <div class="upload-area" id="upscaleUpload" onclick="document.getElementById('upscaleInput').click()">
                <input type="file" id="upscaleInput" accept="video/*" style="display:none" onchange="handleFile(event,'upscale')">
                <div class="upload-icon">‚¨ÜÔ∏è</div>
                <div id="upscaleText">Click to upload video</div>
            </div>
        </div>
        <div class="row-3">
            <div class="form-group">
                <label>Upscale Factor</label>
                <select id="upscaleFactor">
                    <option value="2" selected>2x</option>
                </select>
                <div class="hint">Currently only 2x supported</div>
            </div>
            <div class="form-group">
                <label>Refinement Strength</label>
                <div class="slider-container">
                    <input type="range" id="refinementStrength" min="0" max="1" step="0.1" value="0.3" oninput="updateSlider('refinementStrength')">
                    <span class="slider-value" id="refinementStrengthVal">0.3</span>
                </div>
                <div class="hint">0 = pure upscale, 1 = full AI refinement</div>
            </div>
            <div class="form-group">
                <label class="checkbox-label" style="margin-top:20px;"><input type="checkbox" id="upscaleSkipRefinement"> Skip Refinement (faster)</label>
            </div>
        </div>
        <div class="info-box" id="upscaleEstimate">üìä <span id="upscaleEstimateText">768√ó432 ‚Üí 1536√ó864</span></div>
    </div>
    
    <!-- Temporal Upscale Tab -->
    <div id="upscale_temporal-content" class="tab-content">
        <div class="info-box success-box">üéûÔ∏è <strong>Temporal 2x:</strong> Double frame rate with AI frame interpolation for smoother motion.</div>
        <div class="form-group">
            <label>Upload Video for Frame Interpolation</label>
            <div class="upload-area" id="temporalUpload" onclick="document.getElementById('temporalInput').click()">
                <input type="file" id="temporalInput" accept="video/*" style="display:none" onchange="handleFile(event,'temporal')">
                <div class="upload-icon">üéûÔ∏è</div>
                <div id="temporalText">Click to upload video</div>
            </div>
        </div>
        <div class="info-box">
            <strong>üîÑ 2x Frame Interpolation</strong><br>
            Input: Your video's frames & FPS<br>
            Output: 2x frames @ 2x FPS (same duration, smoother motion)
        </div>
    </div>
    
    <div class="divider"></div>
    
    <!-- Common Prompt Section -->
    <div class="form-group">
        <label>Prompt</label>
        <textarea id="prompt" placeholder="Describe the motion and scene...">Cinematic shot, smooth camera movement, natural motion, high quality</textarea>
    </div>
    <div class="form-group">
        <label>Negative Prompt</label>
        <textarea id="negPrompt" style="min-height:40px">worst quality, blurry, jittery, distorted, watermark, static</textarea>
    </div>
    
    <!-- Basic Settings -->
    <div class="section-header" onclick="toggleSection('basicSettings')">
        <span>üìê Generation Settings</span><span id="basicSettingsToggle">‚ñº</span>
    </div>
    <div id="basicSettings" class="section-content">
        <div class="presets">
            <button type="button" class="preset-btn active" onclick="applyPreset('fast')">‚ö° Fast</button>
            <button type="button" class="preset-btn" onclick="applyPreset('balanced')">‚öñÔ∏è Balanced</button>
            <button type="button" class="preset-btn" onclick="applyPreset('quality')">‚ú® Quality</button>
            <button type="button" class="preset-btn" onclick="applyPreset('hd1080')">üì∫ 1080p</button>
        </div>
        <div class="row-5">
            <div class="form-group">
                <label>Frames</label>
                <select id="frames">
                    <option value="25">25 (~1s)</option>
                    <option value="49" selected>49 (~2s)</option>
                    <option value="73">73 (~3s)</option>
                    <option value="97">97 (~4s)</option>
                    <option value="121">121 (~5s)</option>
                </select>
            </div>
            <div class="form-group">
                <label>Width</label>
                <select id="width">
                    <option value="512">512</option>
                    <option value="640">640</option>
                    <option value="768" selected>768</option>
                    <option value="960">960</option>
                </select>
            </div>
            <div class="form-group">
                <label>Height</label>
                <select id="height">
                    <option value="384">384</option>
                    <option value="432" selected>432</option>
                    <option value="512">512</option>
                    <option value="576">576</option>
                </select>
            </div>
            <div class="form-group">
                <label>FPS</label>
                <select id="fps">
                    <option value="16">16</option>
                    <option value="24" selected>24</option>
                    <option value="30">30</option>
                    <option value="50">50</option>
                </select>
            </div>
            <div class="form-group">
                <label>Seed</label>
                <input type="number" id="seed" value="-1" class="mini-input">
            </div>
        </div>
        <div class="row-3">
            <div class="form-group">
                <label class="checkbox-label"><input type="checkbox" id="enableAudio"> üîä Audio</label>
            </div>
            <div class="form-group">
                <label class="checkbox-label"><input type="checkbox" id="useDistilled" checked> Distilled LoRA</label>
            </div>
            <div class="form-group">
                <label>Checkpoint</label>
                <select id="checkpoint" class="mini-input">
                    <option value="ltx-2-19b-dev-fp8.safetensors">Dev FP8 (T2V)</option>
                    <option value="ltx-2-19b-distilled-fp8.safetensors">Distilled FP8 (I2V)</option>
                </select>
            </div>
        </div>
        <div class="info-box" id="estimateBox">üìä <span id="estimate">768√ó432 ‚Üí 1536√ó864, 49 frames @ 24fps = 2.0s</span></div>
    </div>
    
    <!-- Sampling Settings -->
    <div class="section-header" onclick="toggleSection('samplingSettings')">
        <span>üéõÔ∏è Sampling Parameters</span><span id="samplingSettingsToggle">‚ñ∂</span>
    </div>
    <div id="samplingSettings" class="section-content collapsed advanced-section">
        <div class="row-4">
            <div class="form-group">
                <label class="mini-label">Sampler</label>
                <select id="sampler" class="mini-input">
                    <option value="euler">euler</option>
                    <option value="euler_ancestral" selected>euler_ancestral</option>
                    <option value="dpmpp_2m">dpmpp_2m</option>
                    <option value="dpmpp_2m_sde">dpmpp_2m_sde</option>
                    <option value="dpmpp_3m_sde">dpmpp_3m_sde</option>
                    <option value="ddim">ddim</option>
                    <option value="uni_pc">uni_pc</option>
                </select>
            </div>
            <div class="form-group">
                <label class="mini-label">Steps</label>
                <input type="number" id="steps" class="mini-input" value="20" min="10" max="50">
            </div>
            <div class="form-group">
                <label class="mini-label">CFG</label>
                <input type="number" id="cfg" class="mini-input" value="4.0" step="0.5" min="1" max="15">
            </div>
            <div class="form-group">
                <label class="mini-label">Denoise</label>
                <input type="number" id="denoise" class="mini-input" value="1.0" step="0.1" min="0.1" max="1.0">
            </div>
        </div>
        <div class="row-4">
            <div class="form-group">
                <label class="mini-label">Max Shift</label>
                <input type="number" id="maxShift" class="mini-input" value="2.05" step="0.05" min="0.5" max="5.0">
            </div>
            <div class="form-group">
                <label class="mini-label">Base Shift</label>
                <input type="number" id="baseShift" class="mini-input" value="0.95" step="0.05" min="0.1" max="2.0">
            </div>
            <div class="form-group">
                <label class="mini-label">Terminal</label>
                <input type="number" id="terminal" class="mini-input" value="0.1" step="0.05" min="0" max="1.0">
            </div>
            <div class="form-group">
                <label class="checkbox-label"><input type="checkbox" id="stretch" checked> Stretch</label>
            </div>
        </div>
        <div class="row-3">
            <div class="form-group">
                <label class="mini-label">Scheduler (V2V/Detailer)</label>
                <select id="scheduler" class="mini-input">
                    <option value="normal" selected>normal</option>
                    <option value="karras">karras</option>
                    <option value="exponential">exponential</option>
                    <option value="sgm_uniform">sgm_uniform</option>
                    <option value="simple">simple</option>
                    <option value="beta">beta</option>
                </select>
            </div>
        </div>
    </div>
    
    <!-- Upscale Settings -->
    <div class="section-header" onclick="toggleSection('upscaleSettings')">
        <span>‚¨ÜÔ∏è Upscale Parameters</span><span id="upscaleSettingsToggle">‚ñ∂</span>
    </div>
    <div id="upscaleSettings" class="section-content collapsed advanced-section">
        <div class="row-4">
            <div class="form-group">
                <label class="mini-label">Upscale CFG</label>
                <input type="number" id="upscaleCfg" class="mini-input" value="1.0" step="0.5" min="1" max="10">
            </div>
            <div class="form-group">
                <label class="mini-label">Upscale Sampler</label>
                <select id="upscaleSampler" class="mini-input">
                    <option value="euler">euler</option>
                    <option value="euler_ancestral" selected>euler_ancestral</option>
                </select>
            </div>
            <div class="form-group">
                <label class="mini-label">Distilled LoRA Str</label>
                <input type="number" id="distilledLoraStrength" class="mini-input" value="1.0" step="0.1" min="0.1" max="2.0">
            </div>
        </div>
        <div class="form-group">
            <label class="mini-label">Upscale Sigmas (comma-separated)</label>
            <input type="text" id="upscaleSigmas" class="mini-input" value="0.909375, 0.725, 0.421875, 0.0">
        </div>
    </div>
    
    <!-- VAE Settings -->
    <div class="section-header" onclick="toggleSection('vaeSettings')">
        <span>üñºÔ∏è VAE Decode Parameters</span><span id="vaeSettingsToggle">‚ñ∂</span>
    </div>
    <div id="vaeSettings" class="section-content collapsed advanced-section">
        <div class="row-4">
            <div class="form-group">
                <label class="mini-label">Tile Size</label>
                <input type="number" id="vaeTileSize" class="mini-input" value="512" step="64" min="256" max="1024">
            </div>
            <div class="form-group">
                <label class="mini-label">Overlap</label>
                <input type="number" id="vaeOverlap" class="mini-input" value="64" step="8" min="8" max="128">
            </div>
            <div class="form-group">
                <label class="mini-label">Temporal Size</label>
                <input type="number" id="vaeTemporalSize" class="mini-input" value="4096" step="256" min="512" max="8192">
            </div>
            <div class="form-group">
                <label class="mini-label">Temporal Overlap</label>
                <input type="number" id="vaeTemporalOverlap" class="mini-input" value="8" step="2" min="2" max="32">
            </div>
        </div>
    </div>
    
    <!-- Output Settings -->
    <div class="section-header" onclick="toggleSection('outputSettings')">
        <span>üíæ Output Parameters</span><span id="outputSettingsToggle">‚ñ∂</span>
    </div>
    <div id="outputSettings" class="section-content collapsed advanced-section">
        <div class="row">
            <div class="form-group">
                <label class="mini-label">CRF (Quality: lower=better)</label>
                <input type="number" id="crf" class="mini-input" value="19" min="0" max="51">
            </div>
            <div class="form-group">
                <label class="mini-label">Pixel Format</label>
                <select id="pixFmt" class="mini-input">
                    <option value="yuv420p" selected>yuv420p</option>
                    <option value="yuv444p">yuv444p</option>
                </select>
            </div>
        </div>
    </div>
    
    <div class="gen-buttons" id="genButtons">
        <button onclick="generate()" id="genBtn">üöÄ Generate Video</button>
        <button onclick="stopJob()" id="stopBtn" class="btn-stop">‚èπÔ∏è Stop</button>
    </div>
    
    <div class="loading" id="loading">
        <div class="spinner"></div>
        <div id="loadingText">Starting...</div>
    </div>
    <div class="status" id="status"></div>
    
    <div class="video-container" id="videoContainer">
        <video id="videoPlayer" controls autoplay loop></video>
        <div class="row" style="max-width:350px;margin:12px auto 0;">
            <button onclick="download()" class="btn-secondary">üíæ Download</button>
            <button onclick="generate()" class="btn-secondary">üîÑ Regenerate</button>
        </div>
    </div>
</div>

<script>
let mode='t2v', files={}, jobId=null, videoBlob=null, polling=false, cancelled=false;

const presets = {
    fast: { frames: 49, width: 768, height: 432, fps: 24 },
    balanced: { frames: 73, width: 768, height: 512, fps: 24 },
    quality: { frames: 97, width: 960, height: 576, fps: 24 },
    hd1080: { frames: 97, width: 768, height: 432, fps: 24 }
};

document.querySelectorAll('.tab').forEach(t => t.addEventListener('click', () => {
    document.querySelectorAll('.tab').forEach(x => x.classList.remove('active'));
    document.querySelectorAll('.tab-content').forEach(x => x.classList.remove('active'));
    t.classList.add('active');
    mode = t.dataset.mode;
    document.getElementById(`${mode}-content`).classList.add('active');
    updateEstimate();
}));

document.getElementById('v2vEnableFirstFrame').addEventListener('change', e => {
    document.getElementById('v2vFirstFrameGroup').style.display = e.target.checked ? 'block' : 'none';
    document.getElementById('v2vFFStrengthGroup').style.display = e.target.checked ? 'block' : 'none';
});

document.getElementById('multiEnableFirstFrame').addEventListener('change', e => {
    document.getElementById('multiFirstFrameGroup').style.display = e.target.checked ? 'block' : 'none';
    document.getElementById('multiFFStrengthGroup').style.display = e.target.checked ? 'block' : 'none';
});

['frames','width','height','fps'].forEach(id => document.getElementById(id).addEventListener('change', updateEstimate));

function updateSlider(id) { document.getElementById(id+'Val').textContent = document.getElementById(id).value; }

function updateControlInfo() {
    const t = document.getElementById('controlType').value;
    document.getElementById('cannyParams').style.display = t === 'canny' ? 'grid' : 'none';
}

function updateEstimate() {
    const f = parseInt(document.getElementById('frames').value);
    const w = parseInt(document.getElementById('width').value);
    const h = parseInt(document.getElementById('height').value);
    const fps = parseInt(document.getElementById('fps').value);
    const dur = (f/fps).toFixed(1);
    const skipUpscale = (mode === 'v2v' && document.getElementById('v2vSkipUpscale')?.checked) ||
                        (mode === 'v2v_multi' && document.getElementById('multiSkipUpscale')?.checked) ||
                        (mode === 'detailer' && document.getElementById('detailerSkipUpscale')?.checked);
    const upscales = mode === 't2v' || mode === 'upscale' || ((mode === 'v2v' || mode === 'v2v_multi' || mode === 'detailer') && !skipUpscale);
    const ow = upscales ? w*2 : w, oh = upscales ? h*2 : h;
    document.getElementById('estimate').textContent = `${w}√ó${h} ‚Üí ${ow}√ó${oh}, ${f} frames @ ${fps}fps = ${dur}s`;
    
    // Update upscale-specific estimate
    if (document.getElementById('upscaleEstimateText')) {
        document.getElementById('upscaleEstimateText').textContent = `${w}√ó${h} ‚Üí ${w*2}√ó${h*2}`;
    }
    
    // Update temporal-specific estimate
    if (document.getElementById('temporalEstimateText')) {
        const outFrames = f * 2 - 1;
        const outFps = fps * 2;
        document.getElementById('temporalEstimateText').textContent = `${f} frames @ ${fps}fps ‚Üí ~${outFrames} frames @ ${outFps}fps`;
    }
}

function applyPreset(name) {
    const p = presets[name];
    document.getElementById('frames').value = p.frames;
    document.getElementById('width').value = p.width;
    document.getElementById('height').value = p.height;
    document.getElementById('fps').value = p.fps;
    document.querySelectorAll('#basicSettings .preset-btn').forEach(b => b.classList.remove('active'));
    event.target.classList.add('active');
    updateEstimate();
}

function toggleSection(id) {
    const el = document.getElementById(id);
    el.classList.toggle('collapsed');
    document.getElementById(id+'Toggle').textContent = el.classList.contains('collapsed') ? '‚ñ∂' : '‚ñº';
}

function handleFile(e, type) {
    const file = e.target.files[0]; if (!file) return;
    const reader = new FileReader();
    reader.onload = ev => {
        files[type] = ev.target.result.split(',')[1];
        const preview = document.getElementById(`${type}Preview`);
        if (preview) { preview.src = ev.target.result; preview.classList.add('show'); }
        const upload = document.getElementById(`${type}Upload`);
        if (upload) upload.classList.add('has-file');
        const text = document.getElementById(`${type}Text`);
        if (text) text.textContent = file.name;
    };
    reader.readAsDataURL(file);
}

function showStatus(msg, type='info') {
    const s = document.getElementById('status');
    s.textContent = msg; s.className = `status active ${type}`;
}

function setRunning(running) {
    polling = running;
    document.getElementById('genBtn').disabled = running;
    document.getElementById('stopBtn').classList.toggle('active', running);
    document.getElementById('genButtons').classList.toggle('running', running);
    document.getElementById('loading').classList.toggle('active', running);
}

async function stopJob() {
    if (!jobId || !polling) return;
    cancelled = true;
    showStatus('Cancelling...', 'warning');
    try {
        await fetch(`https://api.runpod.ai/v2/${document.getElementById('endpointId').value}/cancel/${jobId}`, {
            method: 'POST', headers: { 'Authorization': `Bearer ${document.getElementById('apiKey').value}` }
        });
        showStatus('‚èπÔ∏è Cancelled', 'warning');
    } catch(e) {}
    setRunning(false);
}

async function generate() {
    const apiKey = document.getElementById('apiKey').value.trim();
    const endpointId = document.getElementById('endpointId').value.trim();
    if (!apiKey || !endpointId) { showStatus('Enter API Key and Endpoint ID', 'error'); return; }
    
    const seedInput = parseInt(document.getElementById('seed').value);
    const seed = seedInput === -1 ? Math.floor(Math.random()*1e9) : seedInput;
    
    const payload = { input: {
        mode,
        prompt: document.getElementById('prompt').value,
        negative_prompt: document.getElementById('negPrompt').value,
        frame_count: parseInt(document.getElementById('frames').value),
        width: parseInt(document.getElementById('width').value),
        height: parseInt(document.getElementById('height').value),
        fps: parseInt(document.getElementById('fps').value),
        seed,
        enable_audio: document.getElementById('enableAudio').checked,
        use_distilled_lora: document.getElementById('useDistilled').checked,
        checkpoint: document.getElementById('checkpoint').value,
        sampler: document.getElementById('sampler').value,
        steps: parseInt(document.getElementById('steps').value),
        cfg: parseFloat(document.getElementById('cfg').value),
        denoise: parseFloat(document.getElementById('denoise').value),
        max_shift: parseFloat(document.getElementById('maxShift').value),
        base_shift: parseFloat(document.getElementById('baseShift').value),
        terminal: parseFloat(document.getElementById('terminal').value),
        stretch: document.getElementById('stretch').checked,
        scheduler: document.getElementById('scheduler').value,
        upscale_cfg: parseFloat(document.getElementById('upscaleCfg').value),
        upscale_sampler: document.getElementById('upscaleSampler').value,
        upscale_sigmas: document.getElementById('upscaleSigmas').value,
        distilled_lora_strength: parseFloat(document.getElementById('distilledLoraStrength').value),
        vae_tile_size: parseInt(document.getElementById('vaeTileSize').value),
        vae_overlap: parseInt(document.getElementById('vaeOverlap').value),
        vae_temporal_size: parseInt(document.getElementById('vaeTemporalSize').value),
        vae_temporal_overlap: parseInt(document.getElementById('vaeTemporalOverlap').value),
        crf: parseInt(document.getElementById('crf').value),
        pix_fmt: document.getElementById('pixFmt').value
    }};
    
    if (mode === 'i2v') {
        if (!files.i2v) { showStatus('Upload an image', 'error'); return; }
        payload.input.image = files.i2v;
        payload.input.i2v_strength = parseFloat(document.getElementById('i2vStrength').value);
    }
    if (mode === 'keyframe') {
        if (!files.kfStart || !files.kfEnd) { showStatus('Upload both images', 'error'); return; }
        payload.input.start_image = files.kfStart;
        payload.input.end_image = files.kfEnd;
        payload.input.start_strength = parseFloat(document.getElementById('startStrength').value);
        payload.input.end_strength = parseFloat(document.getElementById('endStrength').value);
    }
    if (mode === 'v2v') {
        if (!files.v2v) { showStatus('Upload a video', 'error'); return; }
        payload.input.video = files.v2v;
        payload.input.control_type = document.getElementById('controlType').value;
        payload.input.control_strength = parseFloat(document.getElementById('controlStrength').value);
        payload.input.guiding_strength = parseFloat(document.getElementById('v2vGuidingStrength').value);
        payload.input.canny_low = parseFloat(document.getElementById('cannyLow').value);
        payload.input.canny_high = parseFloat(document.getElementById('cannyHigh').value);
        payload.input.skip_upscale = document.getElementById('v2vSkipUpscale').checked;
        payload.input.enable_first_frame = document.getElementById('v2vEnableFirstFrame').checked;
        payload.input.guiding_start_step = parseInt(document.getElementById('v2vGuidingStart').value);
        payload.input.guiding_end_step = parseInt(document.getElementById('v2vGuidingEnd').value);
        payload.input.depth_resolution = parseInt(document.getElementById('depthResolution').value);
        payload.input.pose_detect_hand = document.getElementById('poseHand').checked;
        payload.input.pose_detect_body = document.getElementById('poseBody').checked;
        payload.input.pose_detect_face = document.getElementById('poseFace').checked;
        payload.input.first_frame_strength = parseFloat(document.getElementById('firstFrameStrength').value);
        if (payload.input.enable_first_frame && files.ff) payload.input.first_frame = files.ff;
    }
    if (mode === 'v2v_multi') {
        if (!files.v2vMulti) { showStatus('Upload a video', 'error'); return; }
        payload.input.video = files.v2vMulti;
        payload.input.enable_canny = document.getElementById('multiEnableCanny').checked;
        payload.input.enable_depth = document.getElementById('multiEnableDepth').checked;
        payload.input.enable_pose = document.getElementById('multiEnablePose').checked;
        payload.input.canny_strength = parseFloat(document.getElementById('multiCannyStrength').value);
        payload.input.depth_strength = parseFloat(document.getElementById('multiDepthStrength').value);
        payload.input.pose_strength = parseFloat(document.getElementById('multiPoseStrength').value);
        payload.input.guiding_strength = parseFloat(document.getElementById('multiGuidingStrength').value);
        payload.input.canny_low = parseFloat(document.getElementById('multiCannyLow').value);
        payload.input.canny_high = parseFloat(document.getElementById('multiCannyHigh').value);
        payload.input.skip_upscale = document.getElementById('multiSkipUpscale').checked;
        payload.input.guiding_start_step = parseInt(document.getElementById('multiGuidingStart').value);
        payload.input.guiding_end_step = parseInt(document.getElementById('multiGuidingEnd').value);
        payload.input.depth_resolution = parseInt(document.getElementById('multiDepthResolution').value);
        payload.input.pose_detect_hand = document.getElementById('multiPoseHand').checked;
        payload.input.pose_detect_body = document.getElementById('multiPoseBody').checked;
        payload.input.pose_detect_face = document.getElementById('multiPoseFace').checked;
        payload.input.enable_first_frame = document.getElementById('multiEnableFirstFrame').checked;
        payload.input.first_frame_strength = parseFloat(document.getElementById('multiFirstFrameStrength').value);
        if (payload.input.enable_first_frame && files.multiFF) payload.input.first_frame = files.multiFF;
        if (!payload.input.enable_canny && !payload.input.enable_depth && !payload.input.enable_pose) {
            showStatus('Enable at least one control type', 'error'); return;
        }
    }
    if (mode === 'detailer') {
        if (!files.detailer) { showStatus('Upload a video', 'error'); return; }
        payload.input.video = files.detailer;
        payload.input.detailer_strength = parseFloat(document.getElementById('detailerStrength').value);
        payload.input.guiding_strength = parseFloat(document.getElementById('detailerGuidingStrength').value);
        payload.input.guiding_start_step = parseInt(document.getElementById('detailerStartStep').value);
        payload.input.guiding_end_step = parseInt(document.getElementById('detailerEndStep').value);
        payload.input.skip_upscale = document.getElementById('detailerSkipUpscale').checked;
    }
    if (mode === 'extend') {
        if (!files.extend) { showStatus('Upload a video', 'error'); return; }
        payload.input.video = files.extend;
        payload.input.extend_direction = document.getElementById('extendDirection').value;
        payload.input.extend_frames = parseInt(document.getElementById('extendFrames').value);
        payload.input.overlap_frames = parseInt(document.getElementById('overlapFrames').value);
        payload.input.conditioning_strength = parseFloat(document.getElementById('extendCondStrength').value);
    }
    if (mode === 'upscale') {
        if (!files.upscale) { showStatus('Upload a video', 'error'); return; }
        payload.input.video = files.upscale;
        payload.input.upscale_factor = parseInt(document.getElementById('upscaleFactor').value);
        payload.input.refinement_strength = parseFloat(document.getElementById('refinementStrength').value);
        if (document.getElementById('upscaleSkipRefinement').checked) {
            payload.input.refinement_strength = 0;
        }
    }
    if (mode === 'upscale_temporal') {
        if (!files.temporal) { showStatus('Upload a video', 'error'); return; }
        payload.input.video = files.temporal;
    }
    
    cancelled = false; setRunning(true);
    document.getElementById('loadingText').textContent = 'Submitting...';
    document.getElementById('videoContainer').style.display = 'none';
    
    try {
        const res = await fetch(`https://api.runpod.ai/v2/${endpointId}/run`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${apiKey}` },
            body: JSON.stringify(payload)
        });
        const data = await res.json();
        if (!res.ok) throw new Error(data.error || res.statusText);
        jobId = data.id;
        showStatus(`Job: ${jobId}`, 'info');
        poll(apiKey, endpointId);
    } catch(e) { setRunning(false); showStatus('Error: '+e.message, 'error'); }
}

async function poll(apiKey, endpointId) {
    let attempts = 0;
    while (attempts < 1200 && polling && !cancelled) {
        attempts++;
        try {
            const res = await fetch(`https://api.runpod.ai/v2/${endpointId}/status/${jobId}`, {
                headers: { 'Authorization': `Bearer ${apiKey}` }
            });
            const data = await res.json();
            if (cancelled) return;
            if (data.status === 'IN_QUEUE') document.getElementById('loadingText').textContent = `Queued... (${attempts}s)`;
            else if (data.status === 'IN_PROGRESS') document.getElementById('loadingText').textContent = `Generating... (${attempts}s)`;
            else if (data.status === 'COMPLETED') {
                setRunning(false);
                if (data.output?.video) {
                    const info = `${data.output.width}√ó${data.output.height}, ${data.output.frames}f, seed: ${data.output.seed}`;
                    showStatus(`‚úÖ Done! ${info}`, 'success');
                    const bytes = Uint8Array.from(atob(data.output.video), c => c.charCodeAt(0));
                    videoBlob = new Blob([bytes], { type: 'video/mp4' });
                    document.getElementById('videoPlayer').src = URL.createObjectURL(videoBlob);
                    document.getElementById('videoContainer').style.display = 'block';
                } else { showStatus('Error: '+(data.output?.error||'No video'), 'error'); console.error(data.output); }
                return;
            } else if (data.status === 'FAILED' || data.status === 'CANCELLED') {
                setRunning(false);
                showStatus(data.status === 'CANCELLED' ? '‚èπÔ∏è Cancelled' : 'Failed', data.status === 'CANCELLED' ? 'warning' : 'error');
                return;
            }
        } catch(e) { console.error(e); }
        await new Promise(r => setTimeout(r, 1000));
    }
    if (!cancelled) { setRunning(false); showStatus('Timeout', 'error'); }
}

function download() {
    if (!videoBlob) return;
    const a = document.createElement('a');
    a.href = URL.createObjectURL(videoBlob);
    a.download = `ltx2_${mode}_${Date.now()}.mp4`;
    a.click();
}

updateControlInfo(); updateEstimate();
</script>
</body>
</html>